# Use a Rust base image for building
FROM rust:1.69 as build

# Set the working directory in the container
WORKDIR /app

# Copy the Cargo.toml and Cargo.lock files
COPY Cargo.toml Cargo.lock ./

# Copy the source code into the container
COPY src ./src

# Build the Rust server
RUN cargo build --release

# once the server is built, we need
# to copy the source code into the
# production image container

# Production image
FROM debian:buster-slim

# Copy the built server binary from the build stage
COPY --from=build /app/target/release/rust_playground .

# Copy the static files
COPY src/static .src/static

# Set the entry point for the container
CMD ["./rust_playground"]
